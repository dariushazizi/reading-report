<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Science Reading Log</title>
    
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
    <!-- Google Fonts: Inter and Fira Code for Cyber theme -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f8fafc; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; }
        ::-webkit-scrollbar-thumb { background: #94a3b8; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #64748b; }
        .tab-active { border-color: #4f46e5; color: #4f46e5; background-color: #eef2ff; }
        .modal-backdrop { transition: opacity 0.3s ease; }
        .modal-content { transition: transform 0.3s ease, opacity 0.3s ease; }

        /* Cyber Theme Styles */
        .cyber-theme {
            background-color: #0d1117;
            background-image: 
                linear-gradient(rgba(20, 184, 166, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(20, 184, 166, 0.1) 1px, transparent 1px);
            background-size: 2rem 2rem;
            font-family: 'Fira Code', monospace;
            border: 1px solid #34d399;
            border-radius: 1rem;
            padding: 2rem;
        }
        .cyber-theme h3, .cyber-theme p, .cyber-theme div, .cyber-theme button, .cyber-theme select, .cyber-theme span, .cyber-theme li, .cyber-theme a {
            color: #a7f3d0; /* teal-200 */
        }
        .cyber-theme h3 {
            text-shadow: 0 0 5px #34d399;
        }
        .cyber-card {
            background-color: rgba(20, 184, 166, 0.05);
            border: 1px solid rgba(52, 211, 153, 0.3);
            backdrop-filter: blur(10px);
        }
        .cyber-glow {
            text-shadow: 0 0 8px #34d399, 0 0 12px #34d399;
        }
        .cyber-select {
            background-color: #0d1117;
            border-color: #34d399;
        }
        .cyber-select option {
            color: #a7f3d0;
            background-color: #0d1117;
        }
        .cyber-button {
            background-color: transparent;
            border: 1px solid #34d399;
            transition: all 0.3s ease;
        }
        .cyber-button:hover {
            background-color: rgba(52, 211, 153, 0.2);
            box-shadow: 0 0 10px #34d399;
        }
        .report-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-bottom: 2px solid transparent;
        }
        .report-tab-active {
            border-bottom-color: #34d399;
            color: #34d399;
            text-shadow: 0 0 5px #34d399;
        }
        .pizza-slice {
            position: absolute;
            width: 50%;
            height: 50%;
            background: #f97316; /* orange-500 */
            transform-origin: 100% 100%;
            border: 1px solid #fdba74;
            opacity: 0;
            transition: opacity 0.5s;
        }
    </style>
</head>
<body class="text-slate-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">

        <!-- Header -->
        <header class="mb-8 text-center">
            <h1 class="text-4xl md:text-5xl font-bold text-slate-900">Data Science Study Log</h1>
            <p class="text-slate-500 mt-2">Track your daily progress, one session at a time.</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="mb-8 border-b border-slate-200">
            <nav class="-mb-px flex space-x-6" aria-label="Tabs">
                <button id="tab-dashboard" class="tab-active whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Dashboard</button>
                <button id="tab-log-entry" class="text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Add New Book</button>
                <button id="tab-analytics" class="text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Mentor Dashboard</button>
                <button id="tab-data" class="text-slate-500 hover:text-slate-700 hover:border-slate-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Data Management</button>
            </nav>
        </div>

        <main>
            <!-- Add New Book Section -->
            <div id="log-entry" class="hidden">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md max-w-2xl mx-auto">
                    <h2 class="text-2xl font-bold mb-6 text-slate-800">Add a New Book to Your Library</h2>
                    <form id="add-book-form" class="space-y-6">
                        <div>
                            <label for="book-title" class="block text-sm font-medium text-slate-700">Book Title</label>
                            <input type="text" id="book-title" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="author" class="block text-sm font-medium text-slate-700">Author</label>
                            <input type="text" id="author" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="topic" class="block text-sm font-medium text-slate-700">Topic / Sub-discipline</label>
                            <input type="text" id="topic" placeholder="e.g., Machine Learning, Statistics, Python, MLOps" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm placeholder-slate-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="status" class="block text-sm font-medium text-slate-700">Initial Status</label>
                            <select id="status" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-slate-300 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm rounded-md">
                                <option>Currently Studying</option>
                                <option>Plan to Read</option>
                                <option>On Hold</option>
                                <option>Finished</option>
                            </select>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">Add Book</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Dashboard Section -->
            <div id="dashboard">
                <div id="reading-log-list" class="space-y-6">
                    <!-- Book cards will be injected here by JS -->
                </div>
                 <div id="no-logs-message" class="text-center py-12 bg-white rounded-lg shadow-sm">
                    <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-slate-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7l-3 3m0 0l-3 3m3-3l3 3" /></svg>
                    <h3 class="mt-2 text-sm font-medium text-slate-900">No books loaded</h3>
                    <p class="mt-1 text-sm text-slate-500">Import your `readings.json` file or add a new book to get started.</p>
                    <div class="mt-6">
                        <button class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">+ Add New Book</button>
                    </div>
                </div>
            </div>

            <!-- Analytics Section -->
            <div id="analytics" class="hidden">
                 <div class="space-y-8 cyber-theme">
                    <!-- Mentor Report & Pizza Tracker -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                        <div class="cyber-card p-6 rounded-xl lg:col-span-2">
                            <div class="flex justify-between items-center mb-4">
                                <h3 class="text-2xl font-bold cyber-glow">Mentor's Report</h3>
                                <button id="export-mentor-dashboard" class="cyber-button px-3 py-1 rounded-md text-sm font-semibold">Export for Mentor</button>
                            </div>
                            <div class="flex space-x-4 border-b border-teal-500/30 mb-4">
                                <button class="report-tab report-tab-active" data-report="daily">Daily</button>
                                <button class="report-tab" data-report="weekly">Weekly</button>
                                <button class="report-tab" data-report="monthly">Monthly</button>
                            </div>
                            <div id="mentor-report-content" class="whitespace-pre-wrap text-sm h-32"></div>
                        </div>
                        <div class="cyber-card p-6 rounded-xl text-center flex flex-col justify-center">
                            <h3 class="text-2xl font-bold mb-4 cyber-glow">Pizza Debt</h3>
                            <div id="pizza-tracker" class="relative w-32 h-32 mx-auto rounded-full bg-yellow-400 border-2 border-yellow-300">
                                <!-- Slices will be injected here -->
                            </div>
                            <p class="mt-4 text-lg">Missed Days: <span id="pizza-slices" class="font-bold cyber-glow">0</span> / 8</p>
                            <p class="mt-1 text-xl">Pizzas Owed: <span id="pizzas-owed" class="font-bold cyber-glow text-red-400">0</span></p>
                        </div>
                    </div>

                    <!-- KPI Cards -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                        <div class="cyber-card p-4 rounded-xl text-center"><p class="text-sm">Total Sessions</p><p id="kpi-total-sessions" class="text-3xl font-bold cyber-glow">0</p></div>
                        <div class="cyber-card p-4 rounded-xl text-center"><p class="text-sm">Avg. Duration</p><p id="kpi-avg-duration" class="text-3xl font-bold cyber-glow">0 min</p></div>
                        <div class="cyber-card p-4 rounded-xl text-center"><p class="text-sm">Busiest Day</p><p id="kpi-busiest-day" class="text-3xl font-bold cyber-glow">N/A</p></div>
                        <div class="cyber-card p-4 rounded-xl text-center"><p class="text-sm">Current Streak</p><p id="kpi-current-streak" class="text-3xl font-bold cyber-glow">0 days</p></div>
                    </div>
                    
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div class="cyber-card p-6 rounded-xl"><h3 class="font-semibold mb-4">Study Time Per Day (Last 30 Days)</h3><canvas id="time-per-day-chart"></canvas></div>
                        <div class="cyber-card p-6 rounded-xl"><h3 class="font-semibold mb-4">Topic Distribution (by Time Spent)</h3><div class="max-w-xs mx-auto"><canvas id="topic-distribution-chart"></canvas></div></div>
                    </div>

                    <!-- Pace Tracker -->
                    <div class="cyber-card p-6 rounded-xl">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-semibold">Reading Pace Tracker</h3><select id="pace-tracker-select" class="text-sm rounded-md border-slate-300 focus:ring-indigo-500 focus:border-indigo-500 cyber-select"></select></div>
                        <canvas id="pace-tracker-chart"></canvas>
                    </div>
                 </div>
            </div>

            <!-- Data Management Section -->
            <div id="data" class="hidden">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md max-w-2xl mx-auto space-y-8">
                    <div>
                        <h2 class="text-2xl font-bold mb-2 text-slate-800">Data Management</h2>
                        <p class="text-sm text-slate-500 mb-6">Save your data to a file to use across different browsers or computers.</p>
                        <div class="space-y-6">
                            <div>
                                <h3 class="text-lg font-medium text-slate-900">Import Data</h3>
                                <p class="mt-1 text-sm text-slate-600">Load your reading log from a `readings.json` file.</p>
                                <div class="mt-4"><input type="file" id="import-file" accept=".json" class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100"/></div>
                            </div>
                            <div class="border-t border-slate-200 pt-6">
                                <h3 class="text-lg font-medium text-slate-900">Export Data</h3>
                                <p class="mt-1 text-sm text-slate-600">Save your current reading log to a `readings.json` file. Remember to save regularly!</p>
                                <div class="mt-4"><button id="export-button" class="inline-flex items-center gap-2 justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"><svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M3 17a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm3.293-7.707a1 1 0 011.414 0L9 10.586V3a1 1 0 112 0v7.586l1.293-1.293a1 1 0 111.414 1.414l-3 3a1 1 0 01-1.414 0l-3-3a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>Export to JSON</button></div>
                            </div>
                        </div>
                    </div>
                    <div class="border-t border-slate-200 pt-6">
                        <h3 class="text-lg font-medium text-slate-900">Accountability</h3>
                        <p class="mt-1 text-sm text-slate-600">If you've paid your pizza debt, you can reset the counter here. This action will be saved when you next export your data.</p>
                        <div class="mt-4">
                            <button id="reset-pizza-debt" class="inline-flex items-center gap-2 justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-orange-500 hover:bg-orange-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500">Reset Pizza Debt</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add/Edit Session Modal -->
    <div id="session-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl w-full max-w-lg transform scale-95 opacity-0">
            <form id="session-form">
                <div class="p-6">
                    <h3 class="text-xl font-bold text-slate-900" id="session-modal-title">Add Reading Session</h3>
                    <input type="hidden" id="session-book-id">
                    <div class="mt-4 space-y-4">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="session-date" class="block text-sm font-medium text-slate-700">Date</label>
                                <input type="date" id="session-date" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                             <div>
                                <label for="session-duration" class="block text-sm font-medium text-slate-700">Duration (minutes)</label>
                                <input type="number" id="session-duration" min="0" required class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                            </div>
                        </div>
                        <div>
                            <label for="session-pages" class="block text-sm font-medium text-slate-700">Pages Read</label>
                            <input type="text" id="session-pages" placeholder="e.g., 15-35" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        </div>
                        <div>
                            <label for="session-summary" class="block text-sm font-medium text-slate-700">Summary & Key Takeaways</label>
                            <textarea id="session-summary" rows="4" class="mt-1 block w-full px-3 py-2 bg-white border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                        </div>
                    </div>
                </div>
                <div class="bg-slate-50 px-6 py-3 flex justify-end space-x-3">
                    <button type="button" id="session-modal-close" class="px-4 py-2 bg-white border border-slate-300 rounded-md text-sm font-medium text-slate-700 hover:bg-slate-50">Cancel</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 border border-transparent rounded-md text-sm font-medium text-white hover:bg-indigo-700">Save Session</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Notification Modal -->
    <div id="notification-modal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50 hidden opacity-0">
        <div class="modal-content bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-center transform scale-95">
            <p id="notification-message" class="text-slate-700"></p>
            <button id="notification-close" class="mt-4 w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-indigo-600 text-base font-medium text-white hover:bg-indigo-700 focus:outline-none sm:text-sm">OK</button>
        </div>
    </div>

    <script>
        // --- STATE MANAGEMENT ---
        let logData = {
            books: [],
            settings: {
                pizzaDebtPaid: 0
            }
        };
        let timePerDayChart, topicDistributionChart, paceTrackerChart;

        // --- DOM ELEMENTS ---
        const addBookForm = document.getElementById('add-book-form');
        const readingLogList = document.getElementById('reading-log-list');
        const noLogsMessage = document.getElementById('no-logs-message');
        const importButton = document.getElementById('import-file');
        const exportButton = document.getElementById('export-button');
        const exportMentorDashboardBtn = document.getElementById('export-mentor-dashboard');
        const resetPizzaBtn = document.getElementById('reset-pizza-debt');
        
        // Modals
        const sessionModal = document.getElementById('session-modal');
        const sessionForm = document.getElementById('session-form');
        const sessionModalCloseBtn = document.getElementById('session-modal-close');
        const notificationModal = document.getElementById('notification-modal');
        const notificationMessage = document.getElementById('notification-message');
        const notificationCloseBtn = document.getElementById('notification-close');

        const tabs = {
            'dashboard': document.getElementById('dashboard'),
            'log-entry': document.getElementById('log-entry'),
            'analytics': document.getElementById('analytics'),
            'data': document.getElementById('data')
        };
        const tabButtons = {
            'dashboard': document.getElementById('tab-dashboard'),
            'log-entry': document.getElementById('tab-log-entry'),
            'analytics': document.getElementById('tab-analytics'),
            'data': document.getElementById('tab-data')
        };
        
        // --- NOTIFICATIONS & MODALS ---
        function showNotification(message) {
            notificationMessage.textContent = message;
            notificationModal.classList.remove('hidden');
            setTimeout(() => {
                notificationModal.classList.remove('opacity-0');
                notificationModal.querySelector('.modal-content').classList.remove('scale-95');
            }, 10);
        }

        function hideNotification() {
            notificationModal.classList.add('opacity-0');
            notificationModal.querySelector('.modal-content').classList.add('scale-95');
            setTimeout(() => notificationModal.classList.add('hidden'), 300);
        }

        function openSessionModal(bookId) {
            document.getElementById('session-book-id').value = bookId;
            document.getElementById('session-date').value = new Date().toISOString().split('T')[0];
            sessionModal.classList.remove('hidden');
            setTimeout(() => {
                sessionModal.classList.remove('opacity-0');
                sessionModal.querySelector('.modal-content').classList.remove('scale-95', 'opacity-0');
            }, 10);
        }

        function closeSessionModal() {
            sessionModal.classList.add('opacity-0');
            sessionModal.querySelector('.modal-content').classList.add('scale-95', 'opacity-0');
            setTimeout(() => {
                sessionModal.classList.add('hidden');
                sessionForm.reset();
            }, 300);
        }
        
        // --- DATA PERSISTENCE (IMPORT/EXPORT) ---
        function exportData() {
            if (logData.books.length === 0 && logData.settings.pizzaDebtPaid === 0) {
                showNotification("There is no data to export.");
                return;
            }
            const dataStr = JSON.stringify(logData, null, 2);
            const dataBlob = new Blob([dataStr], {type: "application/json"});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'readings.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification("Your `readings.json` file has been downloaded.");
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    // Handle both old (array) and new (object) formats
                    if (Array.isArray(importedData)) {
                        logData = { books: importedData, settings: { pizzaDebtPaid: 0 } };
                    } else if (importedData.books && importedData.settings) {
                        logData = importedData;
                    } else {
                        throw new Error("Invalid data structure in JSON file.");
                    }
                    updateAllUI();
                    showNotification(`Successfully imported ${logData.books.length} books.`);
                    changeTab('dashboard');
                } catch (error) {
                    showNotification("Error: Could not import file. " + error.message);
                } finally {
                    event.target.value = ''; 
                }
            };
            reader.readAsText(file);
        }

        // --- UI RENDERING ---
        function renderDashboard() {
            readingLogList.innerHTML = '';
            if (logData.books.length === 0) {
                noLogsMessage.style.display = 'block';
                readingLogList.style.display = 'none';
            } else {
                noLogsMessage.style.display = 'none';
                readingLogList.style.display = 'block';
                
                const sortedBooks = [...logData.books].sort((a, b) => (b.sessions[0]?.date || 0) - (a.sessions[0]?.date || 0));

                sortedBooks.forEach(book => {
                    const totalMinutes = book.sessions.reduce((sum, s) => sum + (parseInt(s.duration, 10) || 0), 0);
                    const totalHours = (totalMinutes / 60).toFixed(1);
                    const totalPages = book.sessions.reduce((sum, s) => {
                        const range = String(s.pagesRead).split('-').map(p => parseInt(p.trim(), 10));
                        if (range.length === 2 && !isNaN(range[0]) && !isNaN(range[1])) {
                            return sum + (range[1] - range[0] + 1);
                        } else if (!isNaN(range[0])) {
                            return sum + 1;
                        }
                        return sum;
                    }, 0);

                    const statusColor = { 'Finished': 'bg-green-100 text-green-800', 'Currently Studying': 'bg-blue-100 text-blue-800', 'On Hold': 'bg-yellow-100 text-yellow-800', 'Plan to Read': 'bg-slate-100 text-slate-800'}[book.status];

                    const bookCard = document.createElement('div');
                    bookCard.className = 'bg-white rounded-xl shadow-md overflow-hidden';
                    bookCard.innerHTML = `
                        <div class="p-5">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-sm font-medium text-indigo-600">${book.topic || 'General'}</p>
                                    <h3 class="text-2xl font-bold text-slate-900">${book.title}</h3>
                                    <p class="text-sm text-slate-600">by ${book.author || 'Unknown Author'}</p>
                                    <span class="mt-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${statusColor}">${book.status}</span>
                                </div>
                                <div class="flex space-x-2">
                                    <button data-action="open-session" data-book-id="${book.id}" class="px-3 py-1 bg-indigo-50 text-indigo-600 rounded-md text-sm font-semibold hover:bg-indigo-100">+ Session</button>
                                    <button data-action="delete-book" data-book-id="${book.id}" class="px-3 py-1 bg-red-50 text-red-600 rounded-md text-sm font-semibold hover:bg-red-100">Delete</button>
                                </div>
                            </div>
                            <div class="mt-4 grid grid-cols-2 gap-4 text-center border-t border-b border-slate-200 py-3">
                                <div>
                                    <p class="text-sm text-slate-500">Total Study Time</p>
                                    <p class="text-xl font-bold">${totalHours} hrs</p>
                                </div>
                                <div>
                                    <p class="text-sm text-slate-500">Total Pages Read</p>
                                    <p class="text-xl font-bold">${totalPages}</p>
                                </div>
                            </div>
                        </div>
                        <div class="bg-slate-50 p-4 space-y-3" id="sessions-for-${book.id}">
                            ${book.sessions.length === 0 ? `<p class="text-center text-sm text-slate-500">No sessions logged for this book yet.</p>` : ''}
                            ${[...book.sessions].sort((a,b) => new Date(b.date) - new Date(a.date)).map(session => `
                                <div class="bg-white p-3 rounded-lg border border-slate-200 flex justify-between items-start">
                                    <div>
                                        <p class="font-bold">${new Date(session.date).toLocaleDateString(undefined, { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                                        <p class="text-sm text-slate-600"><strong>${session.duration} mins</strong> | ${session.pagesRead ? `Pages: <strong>${session.pagesRead}</strong>` : ''}</p>
                                        <p class="mt-2 text-sm text-slate-800 italic">"${session.summary || 'No summary.'}"</p>
                                    </div>
                                    <button data-action="delete-session" data-book-id="${book.id}" data-session-id="${session.id}" class="text-slate-400 hover:text-red-500 text-sm font-medium p-1">&times;</button>
                                </div>
                            `).join('')}
                        </div>
                    `;
                    readingLogList.appendChild(bookCard);
                });
            }
        }

        function renderAnalytics(data = logData.books, settings = logData.settings) {
            const allSessions = data.flatMap(b => b.sessions.map(s => ({...s, topic: b.topic || 'Uncategorized'})));
            
            const mentorReportContentEl = document.getElementById('mentor-report-content');
            if (allSessions.length === 0) {
                mentorReportContentEl.textContent = "No data available to generate a report.";
                return;
            }

            // Pizza Debt Calculation
            const { slices, pizzasOwed, totalMissedDays } = calculatePizzaDebt(allSessions, settings.pizzaDebtPaid);
            document.getElementById('pizza-slices').textContent = slices;
            document.getElementById('pizzas-owed').textContent = pizzasOwed;
            const pizzaTrackerEl = document.getElementById('pizza-tracker');
            pizzaTrackerEl.innerHTML = '';
            for(let i=0; i < 8; i++) {
                const slice = document.createElement('div');
                slice.className = 'pizza-slice';
                slice.style.transform = `rotate(${i * 45}deg) skew(45deg)`;
                if (i < slices) {
                    slice.style.opacity = '1';
                }
                pizzaTrackerEl.appendChild(slice);
            }

            // Reports
            const reports = {
                daily: generateDailyReport(allSessions),
                weekly: generateWeeklyReport(allSessions),
                monthly: generateMonthlyReport(allSessions)
            };
            
            const activeReport = document.querySelector('.report-tab-active')?.dataset.report || 'daily';
            mentorReportContentEl.textContent = reports[activeReport];


            // KPIs
            document.getElementById('kpi-total-sessions').textContent = allSessions.length;
            const totalMinutes = allSessions.reduce((sum, s) => sum + (parseInt(s.duration) || 0), 0);
            const avgDuration = allSessions.length > 0 ? (totalMinutes / allSessions.length).toFixed(0) : 0;
            document.getElementById('kpi-avg-duration').textContent = `${avgDuration} min`;

            const dayCounts = allSessions.reduce((acc, s) => {
                const day = new Date(s.date).toLocaleDateString('en-US', { weekday: 'short' });
                acc[day] = (acc[day] || 0) + 1;
                return acc;
            }, {});
            const busiestDay = Object.keys(dayCounts).length > 0 ? Object.entries(dayCounts).sort((a, b) => b[1] - a[1])[0][0] : 'N/A';
            document.getElementById('kpi-busiest-day').textContent = busiestDay;

            const uniqueDates = [...new Set(allSessions.map(s => s.date))].sort();
            let currentStreak = 0;
            if (uniqueDates.length > 0) {
                let lastDate = new Date(uniqueDates[uniqueDates.length - 1]);
                const todayDate = new Date(new Date().setHours(0,0,0,0));
                const lastSessionDate = new Date(new Date(lastDate).setHours(0,0,0,0));
                
                if(todayDate.getTime() === lastSessionDate.getTime() || todayDate.getTime() - lastSessionDate.getTime() === 86400000) {
                    currentStreak = 1;
                    for (let i = uniqueDates.length - 2; i >= 0; i--) {
                        const currentDate = new Date(uniqueDates[i]);
                        const diff = (lastDate.getTime() - currentDate.getTime()) / (1000 * 3600 * 24);
                        if (diff === 1) {
                            currentStreak++;
                            lastDate = currentDate;
                        } else if (diff > 1) {
                            break;
                        }
                    }
                }
            }
            document.getElementById('kpi-current-streak').textContent = `${currentStreak} days`;


            // Chart.js Global Config for Cyber Theme
            Chart.defaults.font.family = "'Fira Code', monospace";
            Chart.defaults.color = '#a7f3d0';
            Chart.defaults.borderColor = 'rgba(52, 211, 153, 0.2)';

            // Time Per Day Chart
            const last30Days = {};
            for(let i=0; i<30; i++) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                last30Days[d.toISOString().split('T')[0]] = 0;
            }
            allSessions.forEach(s => {
                const date = s.date;
                if(last30Days.hasOwnProperty(date)) {
                    last30Days[date] += (parseInt(s.duration) || 0);
                }
            });
            const timeCtx = document.getElementById('time-per-day-chart').getContext('2d');
            if (timePerDayChart) timePerDayChart.destroy();
            timePerDayChart = new Chart(timeCtx, {
                type: 'bar',
                data: {
                    labels: Object.keys(last30Days).reverse(),
                    datasets: [{
                        label: 'Minutes Studied',
                        data: Object.values(last30Days).reverse(),
                        backgroundColor: 'rgba(52, 211, 153, 0.5)',
                        borderColor: 'rgba(52, 211, 153, 1)',
                        borderWidth: 1
                    }]
                },
                options: { scales: { x: { type: 'time', time: { unit: 'day' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } }, y: { beginAtZero: true, grid: { color: 'rgba(52, 211, 153, 0.2)' } } }, responsive: true, plugins: { legend: { display: false } } }
            });

            // Topic Distribution Chart
            const timeByTopic = allSessions.reduce((acc, s) => {
                acc[s.topic] = (acc[s.topic] || 0) + (parseInt(s.duration) || 0);
                return acc;
            }, {});
            const topicLabels = Object.keys(timeByTopic);
            const topicData = Object.values(timeByTopic);
            const topicCtx = document.getElementById('topic-distribution-chart').getContext('2d');
            if (topicDistributionChart) topicDistributionChart.destroy();
            topicDistributionChart = new Chart(topicCtx, {
                type: 'doughnut',
                data: {
                    labels: topicLabels,
                    datasets: [{
                        label: 'Time by Topic',
                        data: topicData,
                        backgroundColor: ['#14b8a6', '#0891b2', '#6366f1', '#a78bfa', '#ec4899', '#f472b6', '#22d3ee'],
                        borderColor: '#0d1117',
                        hoverOffset: 4
                    }]
                },
                options: { responsive: true, plugins: { legend: { position: 'top', labels: { color: '#a7f3d0' } } } }
            });

            // Pace Tracker
            const paceSelect = document.getElementById('pace-tracker-select');
            paceSelect.innerHTML = data.map(b => `<option value="${b.id}">${b.title}</option>`).join('');
            if (paceSelect.value) {
                renderPaceTracker(paceSelect.value, data);
            }
        }

        function renderPaceTracker(bookId, data = logData.books) {
            const book = data.find(b => b.id === bookId);
            if (!book) return;

            const sortedSessions = [...book.sessions].sort((a, b) => new Date(a.date) - new Date(b.date));
            let cumulativePages = 0;
            const paceData = sortedSessions.map(s => {
                const range = String(s.pagesRead).split('-').map(p => parseInt(p.trim(), 10));
                let pagesReadInSession = 0;
                if (range.length === 2 && !isNaN(range[0]) && !isNaN(range[1])) {
                    pagesReadInSession = range[1] - range[0] + 1;
                } else if (!isNaN(range[0])) {
                    pagesReadInSession = 1;
                }
                cumulativePages += pagesReadInSession;
                return { x: s.date, y: cumulativePages };
            });

            const paceCtx = document.getElementById('pace-tracker-chart').getContext('2d');
            if (paceTrackerChart) paceTrackerChart.destroy();
            paceTrackerChart = new Chart(paceCtx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Cumulative Pages Read',
                        data: paceData,
                        borderColor: '#34d399',
                        backgroundColor: 'rgba(52, 211, 153, 0.2)',
                        fill: true,
                        tension: 0.1,
                        pointBackgroundColor: '#a7f3d0',
                        pointRadius: 4
                    }]
                },
                options: {
                    scales: {
                        x: { type: 'time', time: { unit: 'day', tooltipFormat: 'MMM dd, yyyy' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } },
                        y: { beginAtZero: true, title: { display: true, text: 'Pages' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } }
                    },
                    responsive: true,
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        // --- REPORTING & ACCOUNTABILITY LOGIC ---
        function calculatePizzaDebt(allSessions, paidDebt = 0) {
            if (allSessions.length === 0) return { slices: 0, pizzasOwed: 0, totalMissedDays: 0 };
            
            const sortedDates = [...new Set(allSessions.map(s => s.date))].sort();
            const firstDay = new Date(sortedDates[0]);
            const today = new Date();
            
            const totalDaysSinceStart = Math.ceil((today - firstDay) / (1000 * 60 * 60 * 24));
            const totalStudyDays = sortedDates.length;
            const totalMissedDays = totalDaysSinceStart - totalStudyDays;
            
            const currentDebt = totalMissedDays - paidDebt;
            const pizzasOwed = Math.floor(currentDebt / 8);
            const slices = currentDebt % 8;

            return { slices, pizzasOwed, totalMissedDays };
        }

        function generateDailyReport(allSessions) {
            const todayStr = new Date().toISOString().split('T')[0];
            const todaySessions = allSessions.filter(s => s.date === todayStr);
            if (todaySessions.length === 0) return "No study sessions logged for today.";

            const dailyMinutes = todaySessions.reduce((sum, s) => sum + (parseInt(s.duration) || 0), 0);
            const dailyTopics = [...new Set(todaySessions.map(s => s.topic))];
            return `Today's Progress\n-----------------------------------\nTotal Study Time: ${dailyMinutes} minutes\nTotal Sessions:   ${todaySessions.length}\nTopics Covered:   ${dailyTopics.join(', ') || 'None'}`;
        }

        function generateWeeklyReport(allSessions) {
            const today = new Date();
            const sevenDaysAgo = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 7);
            const weeklySessions = allSessions.filter(s => new Date(s.date) >= sevenDaysAgo);
            const weeklyMinutes = weeklySessions.reduce((sum, s) => sum + (parseInt(s.duration) || 0), 0);
            const weeklyHours = (weeklyMinutes / 60).toFixed(1);
            const weeklyTopics = [...new Set(weeklySessions.map(s => s.topic))];
            const weeklyDaysStudied = [...new Set(weeklySessions.map(s => s.date))].length;
            return `Report: Last 7 Days\n-----------------------------------\nTotal Study Time: ${weeklyHours} hours\nTotal Sessions:   ${weeklySessions.length}\nConsistency:      Studied on ${weeklyDaysStudied} of the last 7 days\nTopics Covered:   ${weeklyTopics.join(', ') || 'None'}`;
        }

        function generateMonthlyReport(allSessions) {
            const today = new Date();
            const thirtyDaysAgo = new Date(today.getFullYear(), today.getMonth(), today.getDate() - 30);
            const monthlySessions = allSessions.filter(s => new Date(s.date) >= thirtyDaysAgo);
            const monthlyMinutes = monthlySessions.reduce((sum, s) => sum + (parseInt(s.duration) || 0), 0);
            const monthlyHours = (monthlyMinutes / 60).toFixed(1);
            const monthlyTopics = [...new Set(monthlySessions.map(s => s.topic))];
            const monthlyDaysStudied = [...new Set(monthlySessions.map(s => s.date))].length;
            return `Report: Last 30 Days\n-----------------------------------\nTotal Study Time: ${monthlyHours} hours\nTotal Sessions:   ${monthlySessions.length}\nConsistency:      Studied on ${monthlyDaysStudied} of the last 30 days\nTopics Covered:   ${monthlyTopics.join(', ') || 'None'}`;
        }


        function updateAllUI() {
            renderDashboard();
            renderAnalytics();
        }

        // --- EVENT HANDLERS ---
        addBookForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const newBook = {
                id: Date.now().toString(),
                title: document.getElementById('book-title').value,
                author: document.getElementById('author').value,
                topic: document.getElementById('topic').value,
                status: document.getElementById('status').value,
                sessions: []
            };
            logData.books.push(newBook);
            addBookForm.reset();
            updateAllUI();
            changeTab('dashboard');
            showNotification("Book added. Now you can log your reading sessions for it!");
        });

        sessionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            const bookId = document.getElementById('session-book-id').value;
            const book = logData.books.find(b => b.id === bookId);
            if(book) {
                const newSession = {
                    id: Date.now().toString(),
                    date: document.getElementById('session-date').value,
                    duration: document.getElementById('session-duration').value,
                    pagesRead: document.getElementById('session-pages').value,
                    summary: document.getElementById('session-summary').value
                };
                book.sessions.push(newSession);
                updateAllUI();
                closeSessionModal();
                showNotification("Session saved. Don't forget to export your data regularly!");
            }
        });

        function deleteBook(bookId) {
            if (window.confirm('Are you sure you want to delete this book and all its sessions?')) {
                logData.books = logData.books.filter(b => b.id !== bookId);
                updateAllUI();
                showNotification("Book deleted.");
            }
        }

        function deleteSession(bookId, sessionId) {
            const book = logData.books.find(b => b.id === bookId);
            if(book) {
                book.sessions = book.sessions.filter(s => s.id !== sessionId);
                updateAllUI();
            }
        }
        
        function changeTab(tabName) {
            Object.values(tabs).forEach(tab => tab.style.display = 'none');
            Object.values(tabButtons).forEach(button => button.classList.remove('tab-active'));
            const key = tabName.replace('tab-', '');
            tabs[key].style.display = 'block';
            tabButtons[key].classList.add('tab-active');
        }

        function exportMentorDashboard() {
            const analyticsHTML = document.getElementById('analytics').innerHTML;
            const analyticsContent = analyticsHTML.replace('<button id="export-mentor-dashboard" class="cyber-button px-3 py-1 rounded-md text-sm font-semibold">Export for Mentor</button>', '');

            const scriptToEmbed = `
                const embeddedLogData = ${JSON.stringify(logData)};
                let timePerDayChart, topicDistributionChart, paceTrackerChart;
                
                // --- EMBEDDED FUNCTIONS ---
                ${calculatePizzaDebt.toString()}
                ${generateDailyReport.toString()}
                ${generateWeeklyReport.toString()}
                ${generateMonthlyReport.toString()}
                
                function renderPaceTracker(bookId, data) {
                    const book = data.find(b => b.id === bookId);
                    if (!book) return;

                    const sortedSessions = [...book.sessions].sort((a, b) => new Date(a.date) - new Date(b.date));
                    let cumulativePages = 0;
                    const paceData = sortedSessions.map(s => {
                        const range = String(s.pagesRead).split('-').map(p => parseInt(p.trim(), 10));
                        let pagesReadInSession = 0;
                        if (range.length === 2 && !isNaN(range[0]) && !isNaN(range[1])) {
                            pagesReadInSession = range[1] - range[0] + 1;
                        } else if (!isNaN(range[0])) {
                            pagesReadInSession = 1;
                        }
                        cumulativePages += pagesReadInSession;
                        return { x: s.date, y: cumulativePages };
                    });

                    const paceCtx = document.getElementById('pace-tracker-chart').getContext('2d');
                    if (paceTrackerChart) paceTrackerChart.destroy();
                    paceTrackerChart = new Chart(paceCtx, {
                        type: 'line',
                        data: {
                            datasets: [{
                                label: 'Cumulative Pages Read',
                                data: paceData,
                                borderColor: '#34d399',
                                backgroundColor: 'rgba(52, 211, 153, 0.2)',
                                fill: true,
                                tension: 0.1,
                                pointBackgroundColor: '#a7f3d0',
                                pointRadius: 4
                            }]
                        },
                        options: {
                            scales: {
                                x: { type: 'time', time: { unit: 'day', tooltipFormat: 'MMM dd, yyyy' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } },
                                y: { beginAtZero: true, title: { display: true, text: 'Pages' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } }
                            },
                            responsive: true,
                            plugins: { legend: { display: false } }
                        }
                    });
                }

                // --- MAIN SCRIPT FOR STATIC PAGE ---
                document.addEventListener('DOMContentLoaded', () => {
                    const { books, settings } = embeddedLogData;
                    const allSessions = books.flatMap(b => b.sessions.map(s => ({...s, topic: b.topic || 'Uncategorized'})));
                    const mentorReportContentEl = document.getElementById('mentor-report-content');
                    if (allSessions.length === 0) { mentorReportContentEl.textContent = "No data available."; return; }

                    const reports = { daily: generateDailyReport(allSessions), weekly: generateWeeklyReport(allSessions), monthly: generateMonthlyReport(allSessions) };
                    mentorReportContentEl.textContent = reports.daily;
                    document.querySelectorAll('.report-tab').forEach(tab => {
                        tab.addEventListener('click', () => {
                            document.querySelector('.report-tab-active').classList.remove('report-tab-active');
                            tab.classList.add('report-tab-active');
                            mentorReportContentEl.textContent = reports[tab.dataset.report];
                        });
                    });

                    const { slices, pizzasOwed } = calculatePizzaDebt(allSessions, settings.pizzaDebtPaid);
                    document.getElementById('pizza-slices').textContent = slices;
                    document.getElementById('pizzas-owed').textContent = pizzasOwed;
                    const pizzaTrackerEl = document.getElementById('pizza-tracker');
                    pizzaTrackerEl.innerHTML = '';
                    for(let i=0; i < 8; i++) {
                        const sliceEl = document.createElement('div');
                        sliceEl.className = 'pizza-slice';
                        sliceEl.style.transform = \`rotate(\${i * 45}deg) skew(45deg)\`;
                        if (i < slices) sliceEl.style.opacity = '1';
                        pizzaTrackerEl.appendChild(sliceEl);
                    }

                    document.getElementById('kpi-total-sessions').textContent = allSessions.length;
                    const totalMinutes = allSessions.reduce((sum, s) => sum + (parseInt(s.duration) || 0), 0);
                    const avgDuration = allSessions.length > 0 ? (totalMinutes / allSessions.length).toFixed(0) : 0;
                    document.getElementById('kpi-avg-duration').textContent = \`\${avgDuration} min\`;
                    const dayCounts = allSessions.reduce((acc, s) => { const day = new Date(s.date).toLocaleDateString('en-US', { weekday: 'short' }); acc[day] = (acc[day] || 0) + 1; return acc; }, {});
                    const busiestDay = Object.keys(dayCounts).length > 0 ? Object.entries(dayCounts).sort((a, b) => b[1] - a[1])[0][0] : 'N/A';
                    document.getElementById('kpi-busiest-day').textContent = busiestDay;
                    const uniqueDates = [...new Set(allSessions.map(s => s.date))].sort();
                    let currentStreak = 0;
                    if (uniqueDates.length > 0) {
                        let lastDate = new Date(uniqueDates[uniqueDates.length - 1]);
                        const todayDate = new Date(new Date().setHours(0,0,0,0));
                        const lastSessionDate = new Date(new Date(lastDate).setHours(0,0,0,0));
                        if(todayDate.getTime() === lastSessionDate.getTime() || todayDate.getTime() - lastSessionDate.getTime() === 86400000) {
                            currentStreak = 1;
                            for (let i = uniqueDates.length - 2; i >= 0; i--) {
                                const currentDate = new Date(uniqueDates[i]);
                                const diff = (lastDate.getTime() - currentDate.getTime()) / (1000 * 3600 * 24);
                                if (diff === 1) { currentStreak++; lastDate = currentDate; } else if (diff > 1) { break; }
                            }
                        }
                    }
                    document.getElementById('kpi-current-streak').textContent = \`\${currentStreak} days\`;
                    Chart.defaults.font.family = "'Fira Code', monospace"; Chart.defaults.color = '#a7f3d0'; Chart.defaults.borderColor = 'rgba(52, 211, 153, 0.2)';
                    const last30Days = {};
                    for(let i=0; i<30; i++) { const d = new Date(); d.setDate(d.getDate() - i); last30Days[d.toISOString().split('T')[0]] = 0; }
                    allSessions.forEach(s => { const date = s.date; if(last30Days.hasOwnProperty(date)) { last30Days[date] += (parseInt(s.duration) || 0); } });
                    const timeCtx = document.getElementById('time-per-day-chart').getContext('2d');
                    timePerDayChart = new Chart(timeCtx, { type: 'bar', data: { labels: Object.keys(last30Days).reverse(), datasets: [{ label: 'Minutes Studied', data: Object.values(last30Days).reverse(), backgroundColor: 'rgba(52, 211, 153, 0.5)', borderColor: 'rgba(52, 211, 153, 1)', borderWidth: 1 }] }, options: { scales: { x: { type: 'time', time: { unit: 'day' }, grid: { color: 'rgba(52, 211, 153, 0.2)' } }, y: { beginAtZero: true, grid: { color: 'rgba(52, 211, 153, 0.2)' } } }, responsive: true, plugins: { legend: { display: false } } } });
                    const timeByTopic = allSessions.reduce((acc, s) => { acc[s.topic] = (acc[s.topic] || 0) + (parseInt(s.duration) || 0); return acc; }, {});
                    const topicLabels = Object.keys(timeByTopic); const topicData = Object.values(timeByTopic);
                    const topicCtx = document.getElementById('topic-distribution-chart').getContext('2d');
                    topicDistributionChart = new Chart(topicCtx, { type: 'doughnut', data: { labels: topicLabels, datasets: [{ label: 'Time by Topic', data: topicData, backgroundColor: ['#14b8a6', '#0891b2', '#6366f1', '#a78bfa', '#ec4899', '#f472b6', '#22d3ee'], borderColor: '#0d1117', hoverOffset: 4 }] }, options: { responsive: true, plugins: { legend: { position: 'top', labels: { color: '#a7f3d0' } } } } });
                    const paceSelect = document.getElementById('pace-tracker-select');
                    paceSelect.innerHTML = books.map(b => \`<option value="\${b.id}">\${b.title}</option>\`).join('');
                    if (paceSelect.value) { renderPaceTracker(paceSelect.value, books); }
                    paceSelect.addEventListener('change', (e) => renderPaceTracker(e.target.value, books));
                });
            `;

            const finalHTML = `
                <!DOCTYPE html>
                <html lang="en">
                <head>
                    <meta charset="UTF-8">
                    <meta name="viewport" content="width=device-width, initial-scale=1.0">
                    <title>Dariush Azizi - Data Science Study Progress</title>
                    <script src="https://cdn.tailwindcss.com"><\/script>
                    <script src="https://cdn.jsdelivr.net/npm/chart.js"><\/script>
                    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"><\/script>
                    <link rel="preconnect" href="https://fonts.googleapis.com">
                    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
                    <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
                    <style>
                        body {
                            background-color: #0d1117;
                            background-image: 
                                linear-gradient(rgba(20, 184, 166, 0.1) 1px, transparent 1px),
                                linear-gradient(90deg, rgba(20, 184, 166, 0.1) 1px, transparent 1px);
                            background-size: 2rem 2rem;
                            font-family: 'Fira Code', monospace;
                            color: #a7f3d0;
                        }
                        .cyber-card { background-color: rgba(20, 184, 166, 0.05); border: 1px solid rgba(52, 211, 153, 0.3); backdrop-filter: blur(10px); }
                        .cyber-glow { text-shadow: 0 0 8px #34d399, 0 0 12px #34d399; }
                        .cyber-select { background-color: #0d1117; border-color: #34d399; color: #a7f3d0; }
                        .report-tab { cursor: pointer; padding: 0.5rem 1rem; border-bottom: 2px solid transparent; }
                        .report-tab-active { border-bottom-color: #34d399; color: #34d399; text-shadow: 0 0 5px #34d399; }
                        .pizza-slice { position: absolute; width: 50%; height: 50%; background: #f97316; transform-origin: 100% 100%; border: 1px solid #fdba74; opacity: 0; }
                    </style>
                </head>
                <body class="p-4 md:p-8">
                    <div class="max-w-7xl mx-auto space-y-8">
                        <header class="text-center border-b-2 border-teal-500/30 pb-4">
                            <h1 class="text-4xl md:text-5xl font-bold cyber-glow">Dariush Azizi's Ph.D. Prep Log</h1>
                            <p class="mt-2 text-teal-300">Live Progress Dashboard as of ${new Date().toLocaleDateString()}</p>
                        </header>
                        <main class="space-y-8">${analyticsContent}</main>
                    </div>
                    <script>${scriptToEmbed}<\/script>
                </body>
                </html>
            `;
            
            const dataBlob = new Blob([finalHTML], {type: "text/html"});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'mentor_dashboard.html';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            showNotification("Mentor Dashboard exported successfully!");
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            Object.keys(tabButtons).forEach(key => {
                tabButtons[key].addEventListener('click', () => changeTab(key));
            });
            document.querySelector('#no-logs-message button').addEventListener('click', () => changeTab('log-entry'));

            exportButton.addEventListener('click', exportData);
            exportMentorDashboardBtn.addEventListener('click', exportMentorDashboard);
            importButton.addEventListener('change', importData);
            sessionModalCloseBtn.addEventListener('click', closeSessionModal);
            notificationCloseBtn.addEventListener('click', hideNotification);
            document.getElementById('pace-tracker-select').addEventListener('change', (e) => renderPaceTracker(e.target.value));
            
            resetPizzaBtn.addEventListener('click', () => {
                const allSessions = logData.books.flatMap(b => b.sessions.map(s => s));
                const { totalMissedDays } = calculatePizzaDebt(allSessions, logData.settings.pizzaDebtPaid);
                const pizzasToPay = Math.floor((totalMissedDays - logData.settings.pizzaDebtPaid) / 8);
                if (pizzasToPay > 0) {
                    logData.settings.pizzaDebtPaid += pizzasToPay * 8;
                    showNotification(`Pizza debt reset! ${pizzasToPay} pizza(s) marked as paid. Export your data to save this change.`);
                    updateAllUI();
                } else {
                    showNotification("No full pizza debts to reset.");
                }
            });

            document.querySelector('#analytics').addEventListener('click', (e) => {
                if (e.target.classList.contains('report-tab')) {
                    document.querySelector('.report-tab-active').classList.remove('report-tab-active');
                    e.target.classList.add('report-tab-active');
                    renderAnalytics(); // Re-render to update the report text
                }
            });

            readingLogList.addEventListener('click', (e) => {
                const button = e.target.closest('button');
                if (!button) return;
                const { action, bookId, sessionId } = button.dataset;
                if (action === 'open-session') openSessionModal(bookId);
                else if (action === 'delete-book') deleteBook(bookId);
                else if (action === 'delete-session') deleteSession(bookId, sessionId);
            });

            updateAllUI();
            changeTab('dashboard');
        });

    </script>
</body>
</html>
